<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceintures CM1</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; color: #1f2937; }
        .min-h-screen { min-height: 100vh; }
        .bg-gradient { background: linear-gradient(to bottom right, #eff6ff, #faf5ff); }
        .bg-gradient-purple { background: linear-gradient(to bottom right, #faf5ff, #fdf2f8); }
        .p-4 { padding: 1rem; } .p-6 { padding: 1.5rem; } .p-8 { padding: 2rem; }
        .mb-2 { margin-bottom: 0.5rem; } .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; } .mb-6 { margin-bottom: 1.5rem; } .mb-8 { margin-bottom: 2rem; }
        .mt-2 { margin-top: 0.5rem; } .mt-3 { margin-top: 0.75rem; }
        .gap-2 { gap: 0.5rem; } .gap-3 { gap: 0.75rem; } .gap-4 { gap: 1rem; }
        .max-w-4xl, .max-w-6xl, .max-w-7xl { margin-left: auto; margin-right: auto; }
        .max-w-4xl { max-width: 56rem; } .max-w-6xl { max-width: 72rem; } .max-w-7xl { max-width: 80rem; }
        .flex { display: flex; } .flex-col { flex-direction: column; } .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; } .items-end { align-items: flex-end; }
        .justify-between { justify-content: space-between; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        .text-center { text-align: center; } .text-left { text-align: left; }
        .font-bold { font-weight: 700; } .font-semibold { font-weight: 600; }
        .text-xs { font-size: 0.75rem; } .text-sm { font-size: 0.875rem; } .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; } .text-xl { font-size: 1.25rem; } .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; } .text-4xl { font-size: 2.25rem; } .text-6xl { font-size: 3.75rem; }
        .text-white { color: white; } .text-gray-400 { color: #9ca3af; } .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; } .text-gray-700 { color: #374151; }
        .text-blue-900 { color: #1e3a8a; } .text-purple-900 { color: #581c87; }
        .text-green-600 { color: #16a34a; } .text-red-600 { color: #dc2626; } .text-orange-600 { color: #ea580c; }
        .bg-white { background-color: white; } .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .rounded { border-radius: 0.25rem; } .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }
        .border { border: 1px solid #d1d5db; } .border-2 { border: 2px solid; }
        .w-full { width: 100%; } .w-8 { width: 2rem; } .w-10 { width: 2.5rem; }
        .w-12 { width: 3rem; } .w-20 { width: 5rem; }
        .h-2 { height: 0.5rem; } .h-4 { height: 1rem; } .h-8 { height: 2rem; }
        .h-10 { height: 2.5rem; } .h-12 { height: 3rem; } .h-20 { height: 5rem; } .h-32 { height: 8rem; }
        .flex-1 { flex: 1; } .overflow-hidden { overflow: hidden; } .overflow-x-auto { overflow-x: auto; }
        .transition-all { transition: all 0.2s; } .duration-500 { transition-duration: 500ms; }
        .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .hover\:shadow-xl:hover { box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .cursor-pointer { cursor: pointer; }
        .relative { position: relative; } .absolute { position: absolute; }
        .top-2 { top: 0.5rem; } .right-2 { right: 0.5rem; }
        .italic { font-style: italic; } .block { display: block; }
        .card { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1); }
        button { cursor: pointer; border: none; border-radius: 0.375rem; font-weight: 500;
                 transition: all 0.2s; padding: 0.5rem 1rem; font-size: 1rem; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-default { background: #6366f1; color: white; }
        .btn-outline { background: white; color: #374151; border: 1px solid #d1d5db; }
        .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.875rem; }
        input, select { outline: none; padding: 0.5rem; border: 1px solid #d1d5db;
                       border-radius: 0.375rem; width: 100%; font-size: 1rem; }
        input:focus, select:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.5rem; }
        thead tr { border-bottom: 2px solid #e5e7eb; }
        tbody tr { border-bottom: 1px solid #e5e7eb; }
        .checkbox { width: 1.25rem; height: 1.25rem; cursor: pointer; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 0.25rem;
                 font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-warning { background: #fef3c7; color: #92400e; }
    </style>
<script src="https://apis.google.com/js/api.js"></script>

</head>
<body>
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration Google Sheets
        const GOOGLE_SHEETS_CONFIG = {
            enabled: false, // √Ä activer apr√®s configuration
            apiKey: '', // Votre cl√© API Google
            spreadsheetId: '', // ID de votre Google Sheet
            range: 'Donn√©es!A:Z'
        };

        const SUBJECTS = [
          { id: 'calcul', name: 'Calcul pos√©', color: '#9333ea' },
          { id: 'grammaire', name: 'Grammaire', color: '#ec4899' },
          { id: 'mesures', name: 'Mesures', color: '#eab308' },
          { id: 'homophones', name: 'Homophones', color: '#f97316' },
          { id: 'conjugaison', name: 'Conjugaison', color: '#06b6d4' }
        ];

        const BELTS = [
          { id: 'blanche', name: 'Blanche', color: '#ffffff', border: '#e5e7eb' },
          { id: 'jaune', name: 'Jaune', color: '#fef08a' },
          { id: 'orange', name: 'Orange', color: '#fdba74' },
          { id: 'rose', name: 'Rose', color: '#f9a8d4' },
          { id: 'verte', name: 'Verte', color: '#86efac' },
          { id: 'bleue', name: 'Bleue', color: '#93c5fd' },
          { id: 'violette', name: 'Violette', color: '#c084fc' },
          { id: 'marron', name: 'Marron', color: '#a78bfa' },
          { id: 'noire', name: 'Noire', color: '#404040' },
          { id: 'etoilee1', name: '√âtoil√©e 1', color: '#ffd700', special: '‚≠ê' },
          { id: 'etoilee2', name: '√âtoil√©e 2', color: '#ffd700', special: '‚≠ê‚≠ê' },
          { id: 'etoilee3', name: '√âtoil√©e 3', color: '#ffd700', special: '‚≠ê‚≠ê‚≠ê' }
        ];

        const DEMO_STUDENTS = [
          { name: 'Alice', gender: 'F' },
          { name: 'Baptiste', gender: 'M' },
          { name: 'Chlo√©', gender: 'F' },
          { name: 'David', gender: 'M' },
          { name: 'Emma', gender: 'F' },
          { name: 'F√©lix', gender: 'M' }
        ];

        // Stockage local ou Google Sheets
        const StorageManager = {
            async get(key) {
                if (GOOGLE_SHEETS_CONFIG.enabled) {
                    return await this.getFromSheets(key);
                }
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            },
            async set(key, value) {
                if (GOOGLE_SHEETS_CONFIG.enabled) {
                    await this.saveToSheets(key, value);
                }
                localStorage.setItem(key, value);
                return { key, value };
            },
            async getFromSheets(key) {
                // TODO: Impl√©menter la lecture depuis Google Sheets
                return null;
            },
            async saveToSheets(key, value) {
                // TODO: Impl√©menter la sauvegarde vers Google Sheets
            }
        };

        const Card = ({ children, className = '', style = {}, onClick }) => (
            <div className={'card ' + className} style={style} onClick={onClick}>{children}</div>
        );

        const CardContent = ({ children, className = '', style = {} }) => (
            <div className={className} style={{padding: '1.5rem', ...style}}>{children}</div>
        );

        const Button = ({ children, onClick, variant = 'default', size, className = '', style = {}, disabled }) => {
            const variantClass = variant === 'outline' ? 'btn-outline' : 'btn-default';
            const sizeClass = size === 'sm' ? 'btn-sm' : '';
            return (
                <button onClick={onClick} disabled={disabled}
                        className={variantClass + ' ' + sizeClass + ' ' + className} style={style}>
                    {children}
                </button>
            );
        };

        const CeinturesApp = () => {
          const [view, setView] = useState('login');
          const [currentStudent, setCurrentStudent] = useState(null);
          const [studentData, setStudentData] = useState({});
          const [students, setStudents] = useState(DEMO_STUDENTS);

          useEffect(() => {
            const loadData = async () => {
              try {
                const studentsResult = await StorageManager.get('ceintures-students');
                let loadedStudents = DEMO_STUDENTS;
                if (studentsResult && studentsResult.value) {
                  loadedStudents = JSON.parse(studentsResult.value);
                  setStudents(loadedStudents);
                }
                
                const dataResult = await StorageManager.get('ceintures-data');
                if (dataResult && dataResult.value) {
                  setStudentData(JSON.parse(dataResult.value));
                } else {
                  const initialData = {};
                  loadedStudents.forEach(student => {
                    initialData[student.name] = {};
                    SUBJECTS.forEach(subject => {
                      initialData[student.name][subject.id] = {
                        currentBelt: 0,
                        trainings: [],
                        history: [] // Historique des ceintures valid√©es
                      };
                    });
                  });
                  setStudentData(initialData);
                  await StorageManager.set('ceintures-data', JSON.stringify(initialData));
                }
              } catch (error) {
                console.log('Init', error);
              }
            };
            loadData();
          }, []);

          const saveData = async (data) => {
            setStudentData(data);
            try {
              await StorageManager.set('ceintures-data', JSON.stringify(data));
            } catch (e) {}
          };

          const saveStudents = async (newStudents) => {
            setStudents(newStudents);
            try {
              await StorageManager.set('ceintures-students', JSON.stringify(newStudents));
            } catch (e) {}
          };

          const addStudent = async (name, gender) => {
            const newStudents = [...students, { name, gender }];
            await saveStudents(newStudents);
            
            const newData = { ...studentData };
            newData[name] = {};
            SUBJECTS.forEach(subject => {
              newData[name][subject.id] = { currentBelt: 0, trainings: [], history: [] };
            });
            await saveData(newData);
          };

          const removeStudent = async (name) => {
            const newStudents = students.filter(s => s.name !== name);
            await saveStudents(newStudents);
            const newData = { ...studentData };
            delete newData[name];
            await saveData(newData);
          };

          const isStudentReady = (trainings) => {
            if (trainings.length < 6) return false;
            const successCount = trainings.filter(t => t.errors <= 1).length;
            return successCount / trainings.length >= 0.7;
          };

          const getSuccessRate = (trainings) => {
            if (trainings.length === 0) return 0;
            const successCount = trainings.filter(t => t.errors <= 1).length;
            return successCount / trainings.length;
          };

          const getProgressForGauge = (trainings) => {
            const trainingProgress = Math.min(trainings.length / 6, 1);
            const successCount = trainings.filter(t => t.errors <= 1).length;
            const rateProgress = trainings.length > 0 ? (successCount / trainings.length) / 0.7 : 0;
            return (trainingProgress + Math.min(rateProgress, 1)) / 2;
          };

          const addTraining = async (student, subject, errors) => {
            const newData = { ...studentData };
            newData[student][subject].trainings.push({ errors, date: Date.now() });
            await saveData(newData);
          };

          const validateBelt = async (student, subject) => {
            const newData = { ...studentData };
            const currentBeltIndex = newData[student][subject].currentBelt;
            newData[student][subject].currentBelt += 1;
            newData[student][subject].trainings = [];
            // Ajouter √† l'historique
            newData[student][subject].history = newData[student][subject].history || [];
            newData[student][subject].history.push({
              beltIndex: currentBeltIndex + 1,
              beltName: BELTS[currentBeltIndex + 1]?.name || '',
              date: Date.now()
            });
            await saveData(newData);
          };

          const setBeltLevel = async (student, subject, beltIndex) => {
            const newData = { ...studentData };
            newData[student][subject].currentBelt = beltIndex;
            newData[student][subject].trainings = [];
            await saveData(newData);
          };

          const rejectTest = async (student, subject) => {
            const newData = { ...studentData };
            newData[student][subject].trainings = [];
            await saveData(newData);
          };

          if (view === 'login') {
            return (
              <div className="min-h-screen bg-gradient p-4">
                <div className="max-w-4xl">
                  <h1 className="text-4xl font-bold text-center mb-8 text-purple-900">
                    Ceintures de comp√©tences CM1
                  </h1>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <Card className="cursor-pointer hover:shadow-lg transition-all" onClick={() => setView('student')}>
                      <CardContent className="text-center p-8">
                        <div className="text-6xl mb-4">üéì</div>
                        <h2 className="text-2xl font-bold text-blue-900">√âl√®ve</h2>
                        <p className="text-gray-600 mt-2">Enregistrer mes entra√Ænements</p>
                      </CardContent>
                    </Card>
                    <Card className="cursor-pointer hover:shadow-lg transition-all" onClick={() => setView('teacher')}>
                      <CardContent className="text-center p-8">
                        <div className="text-6xl mb-4">üë©‚Äçüè´</div>
                        <h2 className="text-2xl font-bold text-purple-900">Enseignante</h2>
                        <p className="text-gray-600 mt-2">Tableau de bord</p>
                      </CardContent>
                    </Card>
                  </div>
                </div>
              </div>
            );
          }

          if (view === 'student' && !currentStudent) {
            return (
              <div className="min-h-screen bg-gradient p-4">
                <div className="max-w-4xl">
                  <div className="flex items-center justify-between mb-8">
                    <h1 className="text-3xl font-bold text-purple-900">Qui es-tu ?</h1>
                    <Button onClick={() => setView('login')} variant="outline">Retour</Button>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {students.map(student => (
                      <Card key={student.name} className="cursor-pointer hover:shadow-lg transition-all"
                            onClick={() => setCurrentStudent(student.name)}>
                        <CardContent className="text-center p-6">
                          <div className="text-4xl mb-2">{student.gender === 'F' ? 'üëß' : 'üë¶'}</div>
                          <p className="font-semibold text-lg">{student.name}</p>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              </div>
            );
          }

          if (view === 'student' && currentStudent) {
            return <StudentView 
              student={currentStudent}
              data={studentData[currentStudent]}
              onBack={() => setCurrentStudent(null)}
              onAddTraining={addTraining}
              isStudentReady={isStudentReady}
              getProgressForGauge={getProgressForGauge}
            />;
          }

          if (view === 'teacher') {
            return <TeacherDashboard 
              studentData={studentData}
              students={students}
              onBack={() => setView('login')}
              isStudentReady={isStudentReady}
              getSuccessRate={getSuccessRate}
              onValidateBelt={validateBelt}
              onRejectTest={rejectTest}
              onSetBeltLevel={setBeltLevel}
              onAddStudent={addStudent}
              onRemoveStudent={removeStudent}
            />;
          }
        };

        const StudentView = ({ student, data, onBack, onAddTraining, isStudentReady, getProgressForGauge }) => {
          const [selectedSubject, setSelectedSubject] = useState(null);

          if (!selectedSubject) {
            return (
              <div className="min-h-screen bg-gradient p-4">
                <div className="max-w-4xl">
                  <div className="flex items-center justify-between mb-8">
                    <h1 className="text-3xl font-bold text-purple-900">Bonjour {student} !</h1>
                    <Button onClick={onBack} variant="outline">Changer d'√©l√®ve</Button>
                  </div>
                  <h2 className="text-xl font-semibold mb-4 text-gray-700">Choisis une mati√®re :</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {SUBJECTS.map(subject => {
                      const subjectData = data[subject.id];
                      const currentBelt = BELTS[subjectData.currentBelt];
                      const progress = getProgressForGauge(subjectData.trainings);
                      const ready = isStudentReady(subjectData.trainings);
                      
                      return (
                        <Card key={subject.id}
                              className="cursor-pointer hover:shadow-xl transition-all hover:scale-105"
                              style={{ borderTop: `6px solid ${subject.color}` }}
                              onClick={() => setSelectedSubject(subject)}>
                          <CardContent className="p-6">
                            <h3 className="text-2xl font-bold mb-3" style={{ color: subject.color }}>
                              {subject.name}
                            </h3>
                            <div className="flex items-center gap-3 mb-3">
                              <div className="w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold"
                                   style={{ 
                                     backgroundColor: currentBelt.color,
                                     border: currentBelt.border ? `2px solid ${currentBelt.border}` : 'none',
                                     color: currentBelt.id === 'noire' ? 'white' : 'black'
                                   }}>
                                {currentBelt.special || ''}
                              </div>
                              <div>
                                <p className="font-semibold text-lg">Ceinture {currentBelt.name}</p>
                                <p className="text-sm text-gray-600">En cours</p>
                              </div>
                            </div>
                            <div className="w-full h-4 bg-gray-200 rounded-full overflow-hidden mt-3">
                              <div className="h-full transition-all duration-500 rounded-full"
                                   style={{ 
                                     width: `${progress * 100}%`,
                                     backgroundColor: ready ? '#22c55e' : subject.color
                                   }}>
                              </div>
                            </div>
                            {ready && (
                              <p className="text-sm text-center mt-2 font-semibold text-green-600">
                                üéâ Tu es pr√™t !
                              </p>
                            )}
                          </CardContent>
                        </Card>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          const subjectData = data[selectedSubject.id];
          const currentBelt = BELTS[subjectData.currentBelt];
          const progress = getProgressForGauge(subjectData.trainings);
          const ready = isStudentReady(subjectData.trainings);

          return (
            <div className="min-h-screen bg-gradient p-4">
              <div className="max-w-4xl">
                <div className="flex items-center justify-between mb-8">
                  <h1 className="text-3xl font-bold" style={{ color: selectedSubject.color }}>
                    {selectedSubject.name}
                  </h1>
                  <Button onClick={() => setSelectedSubject(null)} variant="outline">
                    Retour aux mati√®res
                  </Button>
                </div>

                <Card className="mb-6" style={{ borderTop: `6px solid ${selectedSubject.color}` }}>
                  <CardContent className="p-6">
                    <div className="flex items-center gap-4 mb-6">
                      <div className="w-20 h-20 rounded-full flex items-center justify-center text-2xl font-bold"
                           style={{ 
                             backgroundColor: currentBelt.color,
                             border: currentBelt.border ? `3px solid ${currentBelt.border}` : 'none',
                             color: currentBelt.id === 'noire' ? 'white' : 'black'
                           }}>
                        {currentBelt.special || ''}
                      </div>
                      <div>
                        <h2 className="text-2xl font-bold">Ceinture {currentBelt.name}</h2>
                        <p className="text-gray-600">Objectif actuel</p>
                      </div>
                    </div>

                    <div className="mb-6">
                      <div className="w-full h-12 bg-gray-200 rounded-full overflow-hidden mb-3">
                        <div className="h-full transition-all duration-500 rounded-full flex items-center justify-center"
                             style={{ 
                               width: `${progress * 100}%`,
                               backgroundColor: ready ? '#22c55e' : selectedSubject.color
                             }}>
                          {progress > 0.3 && (
                            <span className="text-white font-bold">{ready ? 'üéâ' : ''}</span>
                          )}
                        </div>
                      </div>
                      <p className="text-center text-lg font-semibold">
                        {ready ? (
                          <span className="text-green-600">üéâ Tu es pr√™t ! Ta ma√Ætresse va te proposer le test.</span>
                        ) : (
                          <span className="text-gray-600">Continue tes entra√Ænements !</span>
                        )}
                      </p>
                    </div>

                    <p className="text-center text-base font-semibold text-gray-700 mb-4">
                      Combien d'erreurs as-tu faites ?
                    </p>

                    <div className="grid grid-cols-3 gap-3">
                      <Button className="h-32 text-lg font-bold flex flex-col gap-2 text-white"
                              style={{ backgroundColor: '#22c55e' }}
                              onClick={() => onAddTraining(student, selectedSubject.id, 0)}>
                        <span className="text-base font-bold">Tout juste</span>
                        <span className="text-4xl">‚úÖ</span>
                      </Button>
                      <Button className="h-32 text-lg font-bold flex flex-col gap-2 text-white"
                              style={{ backgroundColor: '#3b82f6' }}
                              onClick={() => onAddTraining(student, selectedSubject.id, 1)}>
                        <span className="text-base font-bold">1 erreur</span>
                        <span className="text-4xl">‚úÖ</span>
                      </Button>
                      <Button className="h-32 text-lg font-bold flex flex-col gap-2 text-white"
                              style={{ backgroundColor: '#ef4444' }}
                              onClick={() => onAddTraining(student, selectedSubject.id, 2)}>
                        <span className="text-base font-bold">2 erreurs<br/>ou plus</span>
                        <span className="text-4xl">‚ùå</span>
                      </Button>
                    </div>
                  </CardContent>
                </Card>

                {subjectData.trainings.length > 0 && (
                  <Card>
                    <CardContent className="p-6">
                      <h3 className="font-bold text-lg mb-4">Mes derniers entra√Ænements :</h3>
                      <div className="flex flex-wrap gap-2">
                        {subjectData.trainings.slice(-15).reverse().map((training, idx) => {
                          const bgColor = training.errors === 0 ? '#22c55e' : training.errors === 1 ? '#3b82f6' : '#ef4444';
                          return (
                            <div key={idx} 
                                 className="w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold"
                                 style={{ 
                                   backgroundColor: bgColor,
                                   opacity: idx > 8 ? 0.5 : 1,
                                   color: 'white'
                                 }}>
                              {training.errors === 0 ? '0' : training.errors === 1 ? '1' : '2+'}
                            </div>
                          );
                        })}
                      </div>
                    </CardContent>
                  </Card>
                )}
              </div>
            </div>
          );
        };

        const TeacherDashboard = ({ studentData, students, onBack, isStudentReady, getSuccessRate, 
                                    onValidateBelt, onRejectTest, onSetBeltLevel, onAddStudent, onRemoveStudent }) => {
          const [selectedSubject, setSelectedSubject] = useState(null);
          const [showManagement, setShowManagement] = useState(false);
          const [showBeltManager, setShowBeltManager] = useState(null); // {student, subject}
          const [newName, setNewName] = useState('');
          const [newGender, setNewGender] = useState('F');
          const [selectedForValidation, setSelectedForValidation] = useState([]); // Liste des s√©lectionn√©s

          const getReadyStudents = () => {
            const result = [];
            Object.entries(studentData).forEach(([name, subjects]) => {
              Object.entries(subjects).forEach(([subId, data]) => {
                if (isStudentReady(data.trainings)) {
                  const sub = SUBJECTS.find(s => s.id === subId);
                  result.push({
                    student: name,
                    subject: sub.name,
                    subjectId: subId,
                    subjectColor: sub.color,
                    belt: BELTS[data.currentBelt].name,
                    trainingsCount: data.trainings.length,
                    successRate: Math.round(getSuccessRate(data.trainings) * 100)
                  });
                }
              });
            });
            return result;
          };

          const ready = getReadyStudents();

          const toggleSelection = (student, subjectId) => {
            const key = `${student}-${subjectId}`;
            if (selectedForValidation.includes(key)) {
              setSelectedForValidation(selectedForValidation.filter(k => k !== key));
            } else {
              setSelectedForValidation([...selectedForValidation, key]);
            }
          };

          const validateSelected = async () => {
            for (const key of selectedForValidation) {
              const [student, subjectId] = key.split('-');
              await onValidateBelt(student, subjectId);
            }
            setSelectedForValidation([]);
          };

          if (showBeltManager) {
            const { student, subjectId } = showBeltManager;
            const data = studentData[student][subjectId];
            const subject = SUBJECTS.find(s => s.id === subjectId);
            
            return (
              <div className="min-h-screen bg-gradient-purple p-4">
                <div className="max-w-4xl">
                  <div className="flex items-center justify-between mb-8">
                    <h1 className="text-3xl font-bold text-purple-900">
                      G√©rer les ceintures - {student}
                    </h1>
                    <Button onClick={() => setShowBeltManager(null)} variant="outline">Retour</Button>
                  </div>
                  
                  <Card className="mb-6" style={{borderTop: `4px solid ${subject.color}`}}>
                    <CardContent className="p-6">
                      <h2 className="text-2xl font-bold mb-4" style={{color: subject.color}}>
                        {subject.name}
                      </h2>
                      <p className="text-sm text-gray-600 mb-4">
                        Ceinture actuelle : <strong>{BELTS[data.currentBelt].name}</strong>
                      </p>
                      
                      <div className="mb-6">
                        <label className="block text-sm font-semibold mb-2">Changer la ceinture :</label>
                        <select 
                          value={data.currentBelt}
                          onChange={(e) => {
                            if (confirm(`Changer la ceinture de ${student} √† ${BELTS[parseInt(e.target.value)].name} ?`)) {
                              onSetBeltLevel(student, subjectId, parseInt(e.target.value));
                              setShowBeltManager(null);
                            }
                          }}
                          className="w-full p-3 text-lg"
                        >
                          {BELTS.map((belt, idx) => (
                            <option key={belt.id} value={idx}>
                              {belt.name} {belt.special || ''}
                            </option>
                          ))}
                        </select>
                      </div>

                      {data.history && data.history.length > 0 && (
                        <div>
                          <h3 className="font-bold mb-2">Historique des validations :</h3>
                          <div className="space-y-2">
                            {data.history.slice(-5).reverse().map((h, i) => (
                              <div key={i} className="flex items-center justify-between p-2 bg-gray-50 rounded">
                                <span className="font-semibold">{h.beltName}</span>
                                <span className="text-xs text-gray-500">
                                  {new Date(h.date).toLocaleDateString('fr-FR')}
                                </span>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </CardContent>
                  </Card>
                </div>
              </div>
            );
          }

          if (showManagement) {
            return (
              <div className="min-h-screen bg-gradient-purple p-4">
                <div className="max-w-4xl">
                  <div className="flex items-center justify-between mb-8">
                    <h1 className="text-3xl font-bold text-purple-900">G√©rer les √©l√®ves</h1>
                    <Button onClick={() => setShowManagement(false)} variant="outline">Retour</Button>
                  </div>
                  <Card className="mb-6">
                    <CardContent className="p-6">
                      <h2 className="text-xl font-bold mb-4">Ajouter un √©l√®ve</h2>
                      <div className="flex gap-3 items-end">
                        <div className="flex-1">
                          <label className="block text-sm font-semibold mb-2">Pr√©nom</label>
                          <input type="text" value={newName} onChange={(e) => setNewName(e.target.value)}
                                 placeholder="Pr√©nom" />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold mb-2">Genre</label>
                          <div className="flex gap-2">
                            <Button variant={newGender === 'F' ? 'default' : 'outline'}
                                    onClick={() => setNewGender('F')} className="text-2xl px-4">üëß</Button>
                            <Button variant={newGender === 'M' ? 'default' : 'outline'}
                                    onClick={() => setNewGender('M')} className="text-2xl px-4">üë¶</Button>
                          </div>
                        </div>
                        <Button onClick={() => { if(newName) { onAddStudent(newName, newGender); setNewName(''); } }}
                                style={{backgroundColor: '#22c55e', color: 'white'}}>Ajouter</Button>
                      </div>
                    </CardContent>
                  </Card>
                  <Card>
                    <CardContent className="p-6">
                      <h2 className="text-xl font-bold mb-4">Liste ({students.length})</h2>
                      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        {students.map(s => (
                          <Card key={s.name} className="relative">
                            <CardContent className="text-center p-4">
                              <button onClick={() => confirm(`Supprimer ${s.name} ?`) && onRemoveStudent(s.name)}
                                      className="absolute top-2 right-2 text-red-600 text-xl"
                                      style={{background:'none',border:'none'}}>√ó</button>
                              <div className="text-4xl mb-2">{s.gender === 'F' ? 'üëß' : 'üë¶'}</div>
                              <p className="font-semibold">{s.name}</p>
                            </CardContent>
                          </Card>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-purple p-4">
              <div className="max-w-7xl">
                <div className="flex items-center justify-between mb-8">
                  <h1 className="text-3xl font-bold text-purple-900">Tableau de bord</h1>
                  <div className="flex gap-2">
                    <Button onClick={() => setShowManagement(true)} variant="outline">üë• √âl√®ves</Button>
                    <Button onClick={onBack} variant="outline">D√©connexion</Button>
                  </div>
                </div>

                <div className="flex flex-wrap gap-2 mb-6">
                  <Button onClick={() => setSelectedSubject(null)}
                          variant={!selectedSubject ? "default" : "outline"}>Toutes</Button>
                  {SUBJECTS.map(s => (
                    <Button key={s.id} onClick={() => setSelectedSubject(s.id)}
                            variant={selectedSubject === s.id ? "default" : "outline"}
                            style={selectedSubject === s.id ? {backgroundColor: s.color, color: 'white'} : {}}>
                      {s.name}
                    </Button>
                  ))}
                </div>

                <Card className="mb-6 border-2" style={{borderColor: '#22c55e'}}>
                  <CardContent className="p-6">
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-2xl font-bold text-green-600">
                        üéØ Pr√™ts √† tester ({ready.filter(s => !selectedSubject || s.subjectId === selectedSubject).length})
                      </h2>
                      {selectedForValidation.length > 0 && (
                        <div className="flex gap-2">
                          <span className="badge badge-success">{selectedForValidation.length} s√©lectionn√©(s)</span>
                          <Button size="sm" style={{backgroundColor: '#22c55e', color: 'white'}}
                                  onClick={validateSelected}>
                            ‚úì Valider la s√©lection
                          </Button>
                          <Button size="sm" variant="outline" onClick={() => setSelectedForValidation([])}>
                            Annuler
                          </Button>
                        </div>
                      )}
                    </div>
                    
                    {ready.filter(s => !selectedSubject || s.subjectId === selectedSubject).length === 0 ? (
                      <p className="text-gray-500">Aucun</p>
                    ) : (
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        {ready.filter(s => !selectedSubject || s.subjectId === selectedSubject).map((item, i) => {
                          const key = `${item.student}-${item.subjectId}`;
                          const isSelected = selectedForValidation.includes(key);
                          
                          return (
                            <Card key={i} className="hover:shadow-lg" 
                                  style={{border: isSelected ? '2px solid #22c55e' : '1px solid #e5e7eb'}}>
                              <CardContent className="p-4">
                                <div className="flex items-start gap-2 mb-2">
                                  <input 
                                    type="checkbox" 
                                    className="checkbox mt-1"
                                    checked={isSelected}
                                    onChange={() => toggleSelection(item.student, item.subjectId)}
                                  />
                                  <div className="flex-1">
                                    <p className="font-bold text-lg">{item.student} ‚≠ê</p>
                                    <p className="text-sm" style={{color: item.subjectColor}}>
                                      <strong>{item.subject}</strong>
                                    </p>
                                    <p className="text-sm text-gray-600">{item.belt}</p>
                                    <p className="text-xs text-green-600">{item.trainingsCount} ‚Ä¢ {item.successRate}%</p>
                                  </div>
                                </div>
                                <div className="grid grid-cols-3 gap-2 mt-3">
                                  <Button size="sm" style={{backgroundColor: '#22c55e', color: 'white'}}
                                          onClick={() => onValidateBelt(item.student, item.subjectId)}>
                                    ‚úì
                                  </Button>
                                  <Button size="sm" variant="outline" style={{borderColor: '#ef4444', color: '#ef4444'}}
                                          onClick={() => onRejectTest(item.student, item.subjectId)}>
                                    ‚úó
                                  </Button>
                                  <Button size="sm" variant="outline"
                                          onClick={() => setShowBeltManager({student: item.student, subjectId: item.subjectId})}>
                                    ‚öôÔ∏è
                                  </Button>
                                </div>
                              </CardContent>
                            </Card>
                          );
                        })}
                      </div>
                    )}
                  </CardContent>
                </Card>

                <Card>
                  <CardContent className="p-6">
                    <h2 className="text-2xl font-bold mb-4">Vue classe</h2>
                    <div className="overflow-x-auto">
                      <table>
                        <thead>
                          <tr>
                            <th className="text-left">√âl√®ve</th>
                            {SUBJECTS.filter(s => !selectedSubject || s.id === selectedSubject).map(s => (
                              <th key={s.id} className="text-center">
                                <div style={{color: s.color}} className="font-bold">{s.name}</div>
                              </th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {students.map(stu => (
                            <tr key={stu.name} className="hover:bg-gray-50">
                              <td className="font-semibold">
                                <span className="text-xl">{stu.gender === 'F' ? 'üëß' : 'üë¶'}</span> {stu.name}
                              </td>
                              {SUBJECTS.filter(s => !selectedSubject || s.id === selectedSubject).map(sub => {
                                const d = studentData[stu.name]?.[sub.id];
                                if (!d) return <td key={sub.id}></td>;
                                const ready = isStudentReady(d.trainings);
                                const rate = getSuccessRate(d.trainings);
                                const belt = BELTS[d.currentBelt];
                                
                                return (
                                  <td key={sub.id} className="text-center cursor-pointer"
                                      onClick={() => setShowBeltManager({student: stu.name, subjectId: sub.id})}>
                                    <div className="flex flex-col items-center">
                                      <div className="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold"
                                           style={{
                                             backgroundColor: belt.color,
                                             border: belt.border ? `2px solid ${belt.border}` : 'none',
                                             color: belt.id === 'noire' ? 'white' : 'black'
                                           }}>
                                        {belt.special || belt.name.charAt(0)}
                                      </div>
                                      {d.trainings.length > 0 && (
                                        <div className="text-xs">
                                          <span style={{color: ready ? '#22c55e' : '#6b7280'}}>
                                            {d.trainings.length} ‚Ä¢ {Math.round(rate * 100)}%
                                          </span>
                                        </div>
                                      )}
                                    </div>
                                  </td>
                                );
                              })}
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          );
        };

        ReactDOM.render(<CeinturesApp />, document.getElementById('root'));
    </script>
<!-- Boutons pour tester la synchronisation -->
<button onclick="readSheet()">Lire les donn√©es</button>
<button onclick="writeSheet([['Test', '1', '2', '3']])">√âcrire des donn√©es</button>
<div id="data-container"></div>

<!-- Code JavaScript pour la synchronisation -->
<script>
  // Remplace par ta cl√© API et l'ID de ton Google Sheet
  const API_KEY = "AIzaSyAxEz8V8Y5Jw4EtCifiUWpCJDYt5DVqIDs";
  const SPREADSHEET_ID = "1_rDAAO8ov8pzV6O8ET2Auz95C7Q2Vzu3lPsWaeB7oEA";
  const RANGE = "donnees!A1:Z1000"; // Onglet "donnees"

  // Charge l'API Google
  function loadGoogleAPI() {
    gapi.load("client", initClient);
  }

  // Initialise le client API
  function initClient() {
    gapi.client.init({
      apiKey: API_KEY,
      discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
    }).then(function() {
      console.log("API Google Sheets charg√©e avec succ√®s !");
    });
  }

  // Fonction pour lire les donn√©es
  function readSheet() {
    gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: SPREADSHEET_ID,
      range: RANGE,
    }).then(function(response) {
      const data = response.result.values;
      console.log("Donn√©es r√©cup√©r√©es :", data);
      displayData(data);
    }, function(error) {
      console.error("Erreur :", error.result.error.message);
      alert("Erreur : " + error.result.error.message);
    });
  }

  // Fonction pour √©crire des donn√©es
  function writeSheet(data) {
    gapi.client.sheets.spreadsheets.values.update({
      spreadsheetId: SPREADSHEET_ID,
      range: "donnees!A1",
      valueInputOption: "RAW",
      resource: { values: data }
    }).then(function(response) {
      console.log("Donn√©es envoy√©es avec succ√®s !");
      alert("Donn√©es envoy√©es avec succ√®s !");
    }, function(error) {
      console.error("Erreur :", error.result.error.message);
      alert("Erreur : " + error.result.error.message);
    });
  }

  // Affiche les donn√©es dans la page
  function displayData(data) {
    const container = document.getElementById("data-container");
    if (!container) return;

    let html = "<h2>Donn√©es r√©cup√©r√©es :</h2><table border='1'>";
    if (data && data.length > 0) {
      data.forEach(row => {
        html += "<tr>";
        row.forEach(cell => {
          html += `<td>${cell}</td>`;
        });
        html += "</tr>";
      });
    } else {
      html += "<tr><td>Aucune donn√©e disponible.</td></tr>";
    }
    html += "</table>";
    container.innerHTML = html;
  }

  // Charge l'API au d√©marrage
  loadGoogleAPI();
</script>

</body>
</html>